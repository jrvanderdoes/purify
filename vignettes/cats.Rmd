---
title: "cats"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cats}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Overview

This vignette examines the cats data set. The goal of this analysis is to see the effect sex has on the body and heart weight measures.
```{r setup}
library(purify)
library(ggplot2)

summ_function <- function(data) {
  coef(summary(lm(Hwt ~ ., data = data)))
}
```

# Full Data

We first are interested in the coefficients when estimating the body weight using sex and heart weight, stratified on sex since there are far less female cats observed.
```{r strata_plots}
boxplot_strata(cats,'Sex')

ggplot() +
  geom_point(aes(x=Bwt, y=Hwt, col=Sex,shape = Sex),data=subcats) +
  theme_bw() +
  theme(axis.title = element_text(size=22),
        axis.text = element_text(size=18),
        legend.position = c(.2, .8),
        legend.title = element_blank(),
        legend.text = element_text(size=14)) +
  scale_color_discrete(labels = c('Female', 'Male')) +
  scale_shape_manual(labels = c('Female', 'Male'),
                       values = c(16,3))
                       
```

Now modeling the data:
```{r full_estimate}
set.seed(1234)
summ_function(cats)

# Perform resampling
results <- resample_function(data = cats, fn = summ_function, 
                             M = 1000, method = 'stratify',
                             strata='Sex',stratify_sizes='mean')
results$estimates
```

In both methods, the sex was insignificant and body weight was extremely important.

# Subset Data

We are now interested in the coefficients when estimating the body weight using sex and heart weight, stratified on sex since there are far less female cats observed, with a smaller data set. In practice it is hard to know the exact effect of data sizes, so it is worth examining what may happen. We subset the data such that sex will now be more important
```{r substrata_plots}
boxplot_strata(subcats,'Sex')
```

Now modeling the data:
```{r subestimate}
set.seed(1234)
summ_function(subcats)

# Perform resampling
results <- resample_function(data = subcats, fn = summ_function, 
                             M = 1000, method = 'stratify',
                             strata='Sex',stratify_sizes='mean')
results$estimates
```

In examining the data, we can observe that sex is important, but is hard to see due to the low samples. Traditional linear models miss this; however, a resampled method can capture the importance of sex without losing the effects of body weight.

